<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phi·∫øu Chi TT200</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.4;
        }

        /* Container cho to√†n b·ªô trang */
        .page-container {
            max-width: 900px;
            margin: 20px auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        /* Thanh c√¥ng c·ª• - ch·ªâ hi·ªÉn th·ªã tr√™n m√†n h√¨nh */
        .toolbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .toolbar h1 {
            color: white;
            font-size: 20px;
            font-weight: bold;
        }

        .toolbar-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: #28a745;
            border-color: #28a745;
        }

        .btn-primary:hover {
            background: #218838;
        }

        .btn-secondary {
            background: #dc3545;
            border-color: #dc3545;
        }

        .btn-secondary:hover {
            background: #c82333;
        }

        /* Container n·ªôi dung phi·∫øu chi */
        .document-container {
            padding: 40px;
            background: white;
            min-height: 700px;
        }

        /* Header phi·∫øu chi */
        .document-header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 3px solid #333;
            padding-bottom: 25px;
        }

        .document-header .company-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .document-header .company-address {
            font-size: 13px;
            color: #666;
            margin-bottom: 25px;
        }

        .document-header h1 {
            font-size: 32px;
            font-weight: bold;
            margin: 20px 0;
            text-transform: uppercase;
            color: #2c3e50;
            letter-spacing: 2px;
        }

        .document-header .document-info {
            font-size: 15px;
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
        }

        .document-info span {
            background: #f8f9fa;
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid #dee2e6;
        }

        /* B·∫£ng th√¥ng tin */
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
            font-size: 14px;
        }

        .info-table td {
            padding: 12px 15px;
            border: 1px solid #333;
            vertical-align: top;
        }

        .info-table .label {
            background: #f8f9fa;
            font-weight: bold;
            width: 20%;
            color: #495057;
        }

        .info-table .value {
            background: white;
        }

        .info-table .amount {
            font-size: 18px;
            font-weight: bold;
            color: #e74c3c;
            text-align: right;
        }

        /* Ph·∫ßn ch·ªØ k√Ω */
        .signature-section {
            margin-top: 60px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            text-align: center;
        }

        .signature-box {
            padding: 20px 10px;
        }

        .signature-box .title {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 80px;
            color: #2c3e50;
        }

        .signature-box .signature-line {
            border-top: 1px solid #333;
            padding-top: 8px;
            font-size: 12px;
            color: #666;
            font-style: italic;
        }

        /* Footer */
        .document-footer {
            margin-top: 40px;
            text-align: center;
            font-size: 11px;
            color: #999;
            font-style: italic;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .page-container {
                margin: 10px;
                border-radius: 0;
            }
            
            .document-container {
                padding: 20px;
            }
            
            .toolbar {
                flex-direction: column;
                text-align: center;
            }
            
            .document-header .document-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .info-table {
                font-size: 12px;
            }
            
            .info-table td {
                padding: 8px;
            }
        }

        /* Print styles - ·∫©n toolbar khi in */
        @media print {
            body {
                background: white;
                margin: 0;
                padding: 0;
            }
            
            .page-container {
                box-shadow: none;
                border-radius: 0;
                margin: 0;
                max-width: none;
            }
            
            .toolbar {
                display: none !important;
            }
            
            .document-container {
                padding: 20mm;
            }
            
            .signature-section {
                page-break-inside: avoid;
            }
        }

        /* Loading animation */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            text-align: center;
            color: #dc3545;
            padding: 40px;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Thanh c√¥ng c·ª• -->
        <div class="toolbar">
            <h1>üìÑ Phi·∫øu Chi TT200</h1>
            <div class="toolbar-buttons">
                <button class="btn btn-primary" onclick="printDocument()">
                    üñ®Ô∏è In phi·∫øu
                </button>
                <button class="btn btn-secondary" onclick="exportToPDF()">
                    üìë Xu·∫•t PDF
                </button>
                <button class="btn" onclick="downloadHTML()">
                    üíæ T·∫£i HTML
                </button>
                <button class="btn" onclick="copyContent()">
                    üìã Copy
                </button>
            </div>
        </div>

        <!-- N·ªôi dung phi·∫øu chi -->
        <div class="document-container" id="documentContent">
            <div id="loadingState" class="loading">
                <div class="spinner"></div>
                <span>ƒêang t·∫£i d·ªØ li·ªáu...</span>
            </div>
            
            <div id="errorState" class="error-message" style="display: none;">
                <h3>‚ùå Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu</h3>
                <p>Vui l√≤ng ki·ªÉm tra l·∫°i URL v√† th·ª≠ l·∫°i.</p>
            </div>

            <div id="documentBody" style="display: none;">
                <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c generate b·ªüi JavaScript -->
            </div>
        </div>
    </div>

    <script>
        let documentData = {};
        let fileName = '';

        function getParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                donvi: decodeURIComponent(params.get('donvi') || ''),
                diachi: decodeURIComponent(params.get('diachi') || ''),
                quyenso: decodeURIComponent(params.get('quyenso') || ''),
                so: decodeURIComponent(params.get('so') || ''),
                no: decodeURIComponent(params.get('no') || ''),
                co: decodeURIComponent(params.get('co') || ''),
                nguoinhan: decodeURIComponent(params.get('nguoinhan') || ''),
                diachinhan: decodeURIComponent(params.get('diachinhan') || ''),
                lydo: decodeURIComponent(params.get('lydo') || ''),
                sotien: decodeURIComponent(params.get('sotien') || ''),
                kemtheo: decodeURIComponent(params.get('kemtheo') || ''),
                ngay: params.get('ngay') || '',
                thang: params.get('thang') || '',
                nam: params.get('nam') || ''
            };
        }

        function formatCurrency(amount) {
            if (!amount) return '';
            // Lo·∫°i b·ªè k√Ω t·ª± kh√¥ng ph·∫£i s·ªë
            const numStr = amount.toString().replace(/[^\d]/g, '');
            if (!numStr) return amount;
            return numStr.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function generateDocumentContent(data) {
            const dateStr = data.ngay && data.thang && data.nam ? `${data.ngay}/${data.thang}/${data.nam}` : 'Ch∆∞a c√≥';
            const today = new Date().toLocaleString('vi-VN');

            return `
                <div class="document-header">
                    <div class="company-name">${data.donvi || 'T√äN ƒê·ª¢N V·ªä'}</div>
                    <div class="company-address">${data.diachi || 'ƒê·ªãa ch·ªâ ƒë∆°n v·ªã'}</div>
                    <h1>PHI·∫æU CHI</h1>
                    <div class="document-info">
                        <span><strong>Quy·ªÉn s·ªë:</strong> ${data.quyenso || '___'}</span>
                        <span><strong>S·ªë:</strong> ${data.so || '___'}</span>
                    </div>
                </div>

                <table class="info-table">
                    <tr>
                        <td class="label">N·ª£:</td>
                        <td class="value">${data.no || ''}</td>
                        <td class="label">C√≥:</td>
                        <td class="value">${data.co || ''}</td>
                    </tr>
                    <tr>
                        <td class="label">Ng∆∞·ªùi nh·∫≠n:</td>
                        <td class="value" colspan="3">${data.nguoinhan || ''}</td>
                    </tr>
                    <tr>
                        <td class="label">ƒê·ªãa ch·ªâ:</td>
                        <td class="value" colspan="3">${data.diachinhan || ''}</td>
                    </tr>
                    <tr>
                        <td class="label">L√Ω do chi:</td>
                        <td class="value" colspan="3">${data.lydo || ''}</td>
                    </tr>
                    <tr>
                        <td class="label">S·ªë ti·ªÅn:</td>
                        <td class="value amount" colspan="3">${formatCurrency(data.sotien)} ${data.sotien ? 'VNƒê' : ''}</td>
                    </tr>
                    <tr>
                        <td class="label">K√®m theo:</td>
                        <td class="value" colspan="3">${data.kemtheo || ''}</td>
                    </tr>
                    <tr>
                        <td class="label">Ng√†y l·∫≠p:</td>
                        <td class="value" colspan="3"><strong>${dateStr}</strong></td>
                    </tr>
                </table>

                <div class="signature-section">
                    <div class="signature-box">
                        <div class="title">NG∆Ø·ªúI L·∫¨P PHI·∫æU</div>
                        <div class="signature-line">(K√Ω, ghi r√µ h·ªç t√™n)</div>
                    </div>
                    <div class="signature-box">
                        <div class="title">K·∫æ TO√ÅN TR∆Ø·ªûNG</div>
                        <div class="signature-line">(K√Ω, ghi r√µ h·ªç t√™n)</div>
                    </div>
                    <div class="signature-box">
                        <div class="title">TH·ª¶ TR∆Ø·ªûNG ƒê∆†N V·ªä</div>
                        <div class="signature-line">(K√Ω, ghi r√µ h·ªç t√™n, ƒë√≥ng d·∫•u)</div>
                    </div>
                </div>

                <div class="document-footer">
                    Phi·∫øu chi ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông t·ª´ AppSheet - ${today}
                </div>
            `;
        }

        function loadDocument() {
            try {
                documentData = getParams();
                
                // Ki·ªÉm tra n·∫øu c√≥ d·ªØ li·ªáu
                if (!documentData.so && !documentData.donvi && !documentData.nguoinhan) {
                    // Hi·ªÉn th·ªã d·ªØ li·ªáu m·∫´u ƒë·ªÉ demo
                    documentData = {
                        donvi: 'C√îNG TY TNHH ABC',
                        diachi: '123 ƒê∆∞·ªùng ABC, Ph∆∞·ªùng XYZ, TP.HCM',
                        quyenso: '001',
                        so: '0001',
                        no: '111',
                        co: '511',
                        nguoinhan: 'Nguy·ªÖn VƒÉn A',
                        diachinhan: '456 ƒê∆∞·ªùng DEF, Qu·∫≠n 1, TP.HCM',
                        lydo: 'Chi ph√≠ vƒÉn ph√≤ng ph·∫©m th√°ng 6/2025',
                        sotien: '1500000',
                        kemtheo: 'H√≥a ƒë∆°n VAT s·ªë 001',
                        ngay: '23',
                        thang: '6',
                        nam: '2025'
                    };
                }

                // Generate filename
                fileName = `PhieuChi_${documentData.so || 'demo'}_${documentData.ngay || ''}${documentData.thang || ''}${documentData.nam || ''}.html`;

                // Hi·ªÉn th·ªã n·ªôi dung
                setTimeout(() => {
                    document.getElementById('loadingState').style.display = 'none';
                    document.getElementById('documentBody').style.display = 'block';
                    document.getElementById('documentBody').innerHTML = generateDocumentContent(documentData);
                }, 800);

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('errorState').style.display = 'block';
            }
        }

        // Ch·ª©c nƒÉng in
        function printDocument() {
            window.print();
        }

        // Ch·ª©c nƒÉng xu·∫•t PDF (s·ª≠ d·ª•ng print dialog v·ªõi PDF option)
        function exportToPDF() {
            // T·∫°o th√¥ng b√°o h∆∞·ªõng d·∫´n
            alert('üí° H∆∞·ªõng d·∫´n xu·∫•t PDF:\n\n1. Nh·∫•n Ctrl+P (ho·∫∑c Cmd+P tr√™n Mac)\n2. Ch·ªçn "Save as PDF" trong danh s√°ch m√°y in\n3. Nh·∫•n "Save" ƒë·ªÉ l∆∞u file PDF\n\n‚è≥ C·ª≠a s·ªï in s·∫Ω m·ªü trong 2 gi√¢y...');
            
            setTimeout(() => {
                window.print();
            }, 2000);
        }

        // Ch·ª©c nƒÉng t·∫£i HTML
        function downloadHTML() {
            const fullHTML = `<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phi·∫øu Chi TT200 - ${documentData.so}</title>
    <style>
        body { font-family: 'Times New Roman', serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .document-header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
        .document-header h1 { font-size: 28px; margin: 15px 0; }
        .info-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .info-table td { padding: 10px; border: 1px solid #333; }
        .info-table .label { background: #f5f5f5; font-weight: bold; width: 20%; }
        .amount { font-size: 16px; font-weight: bold; color: #d32f2f; }
        .signature-section { margin-top: 50px; display: flex; justify-content: space-between; }
        .signature-box { text-align: center; width: 30%; }
        .signature-line { border-top: 1px solid #333; margin-top: 60px; padding-top: 5px; font-size: 12px; }
        @media print { body { margin: 0; padding: 15mm; } }
    </style>
</head>
<body>
    ${document.getElementById('documentBody').innerHTML}
</body>
</html>`;

            const blob = new Blob([fullHTML], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('‚úÖ File HTML ƒë√£ ƒë∆∞·ª£c t·∫£i xu·ªëng!');
        }

        // Ch·ª©c nƒÉng copy
        function copyContent() {
            const content = document.getElementById('documentBody').innerText;
            navigator.clipboard.writeText(content).then(() => {
                alert('‚úÖ ƒê√£ copy n·ªôi dung phi·∫øu chi!');
            }).catch(() => {
                alert('‚ùå Kh√¥ng th·ªÉ copy. Vui l√≤ng copy th·ªß c√¥ng.');
            });
        }

        // Load khi trang kh·ªüi ƒë·ªông
        window.onload = loadDocument;
    </script>
</body>
</html>
